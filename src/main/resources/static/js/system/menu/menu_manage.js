$().ready(function () {    $('#menuTree').on("changed.jstree", function (e, data) {        // console.log("selected:"+data.changed.selected); // newly selected        // console.log("deselected"+data.changed.deselected); // newly deselected    }).jstree({        'core': {            "animation" : 0,            "check_callback" : true,            "themes" :            {                "theme" : "classic",                "dots" : true            },            'data': JSON.parse(menuTreeData)        },        "types":{            "#" : {                "max_children" : 1,                "max_depth" : 4,                "valid_children" : ["root"]            }        },        "plugins" : [            "contextmenu",            "search",            "changed"        ],        "contextmenu": {            "items": {                "create": null,                "rename": null,                "remove": null,                "ccp": null,                "add": {                    "label": "新增下级菜单",                    "action": function (obj) {                        var inst = jQuery.jstree.reference(obj.reference);                        var clickedNode = inst.get_node(obj.reference);                        if(clickedNode.data.extremity) {                            toastObj.toastMsg(true, true, "toast-top-center", "warning",                                "已经是最后一级菜单，不允许新增下级菜单");                            return;                        }                        $("#actionType").attr("value", "1");                        menuObj.freshAddMenuModal(clickedNode.id);                        $("#addMenuModal").modal('show');                    }                },                update:{                    "label": "编辑菜单",                    "action": function (obj) {                        var inst = jQuery.jstree.reference(obj.reference);                        var clickedNode = inst.get_node(obj.reference);                        $("#actionType").attr("value", "2");                        menuObj.getMenuById(clickedNode.id);                    }                },                "delete": {                    "label": "删除菜单",                    "action": function (obj) {                        var inst = jQuery.jstree.reference(obj.reference);                        var clickedNode = inst.get_node(obj.reference);                        alertObj.sweetAlert("您确定要删除这个菜单吗","删除后将无法恢复，请谨慎操作！","删除","我不删了",                        function () {                            if(clickedNode.children.length>0){                                swal("提示信息", "父级菜单不能直接删除!", "error");                                return false;                            }                            menuObj.deleteMenu(clickedNode.id);                        },                        function () {                            swal("已取消", "您取消了删除操作！", "error");                        })                    }                }            }        }    });    var menuObj = {        "refreshTree":function (data) {            var menuTree = $('#menuTree').jstree(true);            menuTree.settings.core.data = JSON.parse(data);            menuTree.refresh();        },        "addMenu":function () {            var param = {};            param["text"] = $("#menuName").val();            param["sortNo"] = $("#sortNo").val();            param["icon"] = $("#icon").val();            param["parentPermitId"] = $("#parentId").val();            param["permitType"] = $("#menuType").val();            param["url"] = $("#url").val();            $("input[name=extremity]").each(function (index,value) {                if(true === $(this).is(':checked')){                    param["extremity"] = $(this).val();                }            });            var ajaxObj = {              url: "/menu/addMenu",              param: JSON.stringify(param),              method: "POST",              contentType: "application/json"            };            commonJS.sendAjaxRequest(ajaxObj, function(data) {                if(data.code=="1"){                    toastObj.toastMsg(true, true, "toast-top-center", "success", "新增成功");                    menuObj.refreshTree(data.data);                    menuObj.freshAddMenuModal(0);                }else{                    addMenuFormValidate.showErrors(JSON.parse(data.data));                }            });        },        "deleteMenu":function (menuId) {            var ajaxObj = {              url: "/menu/updateMenuStatus",              param: JSON.stringify({permitId:menuId,status:"0"}),              method: "POST",              contentType: "application/json"            };            commonJS.sendAjaxRequest(ajaxObj, function(data) {              if(data.code=="1"){                    swal("删除成功！", "您已经永久删除了这条信息。", "success");                    menuObj.refreshTree(data.data);                }else{                    swal("删除失败！", data.message, "error");                }            });        },        "getMenuById":function (menuId) {/*获取菜单信息，打开编辑窗口*/            var ajaxObj = {url:'/menu/getMenuById',param:{"id":menuId,"status":"0"},method:"GET"};            commonJS.sendAjaxRequest(ajaxObj, function(data) {                if(data.code=="1"){                    $("#id").val(data.data.permitId);                    $("#parentId").val(data.data.parentPermitId);                    $("#menuType").val(data.data.permitType);                    $("#menuName").val(data.data.text);                    $("#sortNo").val(data.data.sortNo);                    $("#url").val(data.data.url);                    $("#icon").val(data.data.icon);                    $("#iconShow").attr("class", data.data.icon);                    if(data.data.icon!==""){                        $("#delBtn").show();                    }else{                        $("#delBtn").hide();                    }                    $("input[name=extremity]").each(function (index,value) {                        if($(this).val()==data.data.extremity){                            $(this).iCheck('check');                        }                        $(this).iCheck('disable');                    });                    $("#addMenuModal").modal('show');                }else{                }            });        },        "updateMenu":function () {/*修改菜单*/            var param = {};            param["permitId"] = $("#id").val();            param["text"] = $("#menuName").val();            param["sortNo"] = $("#sortNo").val();            param["icon"] = $("#icon").val();            param["parentPermitId"] = $("#parentId").val();            param["permitType"] = $("#menuType").val();            param["url"] = $("#url").val();            $("input[name=extremity]").each(function (index,value) {                if(true === $(this).is(':checked')){                    param["extremity"] = $(this).val();                }            });            var ajaxObj = {              url: "/menu/updateMenu",              param: JSON.stringify(param),              method: "POST",              contentType: "application/json"            };            commonJS.sendAjaxRequest(ajaxObj, function(data) {                if(data.code=="1"){                    toastObj.toastMsg(true, true, "toast-top-center", "success", "修改成功");                    menuObj.freshAddMenuModal(0);                    menuObj.refreshTree(data.data);                }else{                    addMenuFormValidate.showErrors(JSON.parse(data.data));                }            });        },        "freshAddMenuModal":function (parentId) {/*刷新Modal弹窗*/            $("input[name=extremity]").each(function (index,value) {                if($(this).val()=="1"){                    $(this).iCheck('check');                    $("#isExtremity").attr("value","1");                }else{                    $(this).iCheck('uncheck');                }                $(this).iCheck('enable');            });            $("#icon").val("");            $("#id").val("");            $("#menuType").val(1);            $("#menuName").val("");            $("#sortNo").val("");            $("#url").val("");            $("#iconShow").attr("class","");            $("#parentId").val(parentId);            $("#actionType").attr("value", "1");        }    };    /*绑定添加一级菜单*/    $("#addOneLevelMenu").on("click",function () {        menuObj.freshAddMenuModal(0);        $("#addMenuModal").modal("show");    });    /*切换是否是最后一级菜单控制*/    $("input[name=extremity]").on("ifChecked",function () {        var extremity = $(this).val();       if("0"===extremity) {           $("#menu_url_div").hide();       }else{           $("#menu_url_div").show();       }       $("#isExtremity").attr("value",extremity);    });    /*美化单选按钮*/    $('.i-checks').iCheck({        checkboxClass: 'icheckbox_square-green',        radioClass: 'iradio_square-green'    });    /*绑定图标选择事件*/    $(".fa-hover a").on("click",function () {        var showClass = $(this).find("i").attr("class");        $("#icon").val(showClass);        $("#iconShow").attr("class", showClass);        $("#delBtn").show();        $("#fontModal").modal("hide");    });    /*绑定图标删除事件*/    $("#delBtn").on("click",function () {        $("#icon").val("");        $("#iconShow").attr("class", "");        $("#delBtn").hide();    });    /*form 验证开始*/    var icon = "<i class='fa fa-times-circle'></i> ";    var addMenuFormValidate =  $("#addMenuForm").validate({        rules: {            menuName:{                required: true,                minlength: 2,                maxlength: 45            },            sortNo:{                required: true,                digits: true,                min:0            },            url:{                checkMenuUrl:"#isExtremity"            }        },        messages: {            menuName: {                required: icon + "请输入菜单名称",                minlength: icon + "菜单名称必须2个字符以上",                maxlength: icon + "菜单名称最长不能超过45字符"            },            sortNo:{                required: icon + "请输入菜单排序",                digits: icon + "请输入整数",                min: icon + "请输入0以上整数"            },            url:{                checkMenuUrl:"请输入菜单url"            }        },        submitHandler:function (form) {            $("#addMenuModal").modal('hide');            var actionType = $("#actionType").val();            if(actionType=="1"){                menuObj.addMenu();            }else{                menuObj.updateMenu();            }        },        invalidHandler:function (form,validator) {            return false;        }    });});