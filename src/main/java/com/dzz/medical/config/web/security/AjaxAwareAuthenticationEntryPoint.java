package com.dzz.medical.config.web.security;import com.alibaba.fastjson.JSONObject;import com.dzz.medical.common.response.ResponseDzz;import java.io.IOException;import java.io.PrintWriter;import javax.servlet.ServletException;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import lombok.extern.slf4j.Slf4j;import org.springframework.security.core.AuthenticationException;import org.springframework.security.web.authentication.LoginUrlAuthenticationEntryPoint;/** * 登录授权处理 * @author dzz * @version 1.0.0 * @since 2017年07月10 下午5:26 */@Slf4jpublic class AjaxAwareAuthenticationEntryPoint extends LoginUrlAuthenticationEntryPoint{    public AjaxAwareAuthenticationEntryPoint(String loginFormUrl) {        super(loginFormUrl);    }    @Override    public void commence(HttpServletRequest request, HttpServletResponse response,            AuthenticationException authException) throws IOException, ServletException {        if (isAjax(request)) {            try(PrintWriter writer = response.getWriter()){                response.setHeader("Content-type", "text/html;charset=UTF-8");                response.setStatus(403);                writer.write(JSONObject.toJSONString(ResponseDzz.build("-9", "登录超时了。")));                writer.flush();            }catch (IOException e){                log.error("writer出现异常", e);            }        } else {            super.commence(request, response, authException);        }    }    /**     * 判断是否为Ajax请求     * @param request 请求对象     * @return 是否为ajax请求     */    private static boolean isAjax(HttpServletRequest request){        return  (request.getHeader("X-Requested-With") != null                && "XMLHttpRequest".equals(request.getHeader("X-Requested-With"))) ;    }}